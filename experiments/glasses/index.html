<!DOCTYPE html>
<html lang="en-us" prefix="og: http://ogp.me/ns#">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

	<!-- FB Open Graph Tags -->
	<meta property="fb:app_id"       content="638458746355035" />
	<meta property="og:url"          content="http://lab.callaunchpad.org" />
	<meta property="og:type"         content="website" />
	<meta property="og:title"        content="Web Experiments by Launchpad." />
	<meta property="og:description"  content="Online lab of live demos and web experiments." />
	<!-- TODO: Update image -->
	<meta property="og:image"        content="http://callaunchpad.org/img/og_image.png" />

	<!-- Meta Tags for SEO -->
	<title>Web Experiments by Launchpad</title>
	<meta name='subject' content='Software' />
	<meta name='description' content='Online lab of live demos and web experiments.' />
	<meta name='keywords' content='intelligent, software, machine learning, artificial intelligence, data science, Berkeley, Cal, Sherlock, Whisper, Lively, Launchpad' />
	<meta name='url' content='http://lab.callaunchpad.org' />
	<meta name='reply-to' content='team@callaunchpad.org' />
	<meta name='copyright' content='Launchpad' />
	<meta name='robots' content='index, follow' />

	<!-- FAVICON -->
	<link rel="apple-touch-icon" sizes="57x57" href="img/favicon/apple-icon-57x57.png?v=2">
	<link rel="apple-touch-icon" sizes="60x60" href="img/favicon/apple-icon-60x60.png?v=2">
	<link rel="apple-touch-icon" sizes="72x72" href="img/favicon/apple-icon-72x72.png?v=2">
	<link rel="apple-touch-icon" sizes="76x76" href="img/favicon/apple-icon-76x76.png?v=2">
	<link rel="apple-touch-icon" sizes="114x114" href="img/favicon/apple-icon-114x114.png?v=2">
	<link rel="apple-touch-icon" sizes="120x120" href="img/favicon/apple-icon-120x120.png?v=2">
	<link rel="apple-touch-icon" sizes="144x144" href="img/favicon/apple-icon-144x144.png?v=2">
	<link rel="apple-touch-icon" sizes="152x152" href="img/favicon/apple-icon-152x152.png?v=2">
	<link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-icon-180x180.png?v=2">
	<link rel="icon" type="image/png" sizes="192x192"  href="img/favicon/android-icon-192x192.png?v=2">
	<link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png?v=2">
	<link rel="icon" type="image/png" sizes="96x96" href="img/favicon/favicon-96x96.png?v=2">
	<link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png?v=2">
	<link rel="manifest" href="img/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png?v=2">
	<meta name="theme-color" content="#ffffff">

	<link rel="stylesheet" href="css/style.css">
	</head>
	<body>

		<!-- BEGIN EXPERIMENT -->

		<div class="parallax-container">
		  <div class="parallax">
		    <div class="title-cover valign-wrapper">
		      <div class="text-container valign center">
		        <h3 class="white-text">Glasses with Face Detection</h3>
		        <p class="white-text">Web experiment that uses Haar Cascades for face detection.</p>
		      </div>
		    </div>
		    <img class="cover-img" src="img/star-background.jpg">
		  </div>
		</div>

		<button id="startButton" onclick="startDemo()">Start</button>
		<div id="display"">
			<video id="video" style="float: left; margin-right: 1em;"></video>
			<div class="glass-container">
				<div id="list" class="glass-list">
					<img class="glass" src="./media/sunglasses_0.png" style="width: 117px;">
					<img class="glass" src="./media/sunglasses_1.png" style="width: 117px;">
					<img class="glass" src="./media/sunglasses_2.png" style="width: 117px;">
					<img class="glass" src="./media/sunglasses_3.png" style="width: 117px;">
					<img class="glass" src="./media/sunglasses_4.png" style="width: 117px;">
					<img class="glass" src="./media/sunglasses_5.png" style="width: 117px;">
					<img class="glass" src="./media/sunglasses_6.png" style="width: 117px;">
					<img class="glass" src="./media/sunglasses_7.png" style="width: 117px;">
				</div>
			</div>
		</div>

		<img id="glasses" src="./media/sunglasses_0.png" style="position: absolute; display: block; opacity: 0">
		<style type="text/css">
			.glass-container {
				position: relative;
				width: 100%;
			}
			.glass-list {
				display: inline-block;
				position: relative;
				left: 50%;
				transform: translateX(-45%);
			}
			.glass {
				margin: 0.8em;
			}

			.hide {
				display: none;
			}

			.show {
				display: block;
			}
		</style>

		<script src="./js/compatibility.js"></script>
		<script src="./js/smoother.js"></script>
		<script src="./js/objectdetect.js"></script>
		<script src="./js/objectdetect.frontalface_alt.js"></script>

		<script>
		function startDemo() {
			$('#startButton').hide();
			$('#display').show();
			var smoother = new Smoother([0.9999999, 0.9999999, 0.999, 0.999], [0, 0, 0, 0]),
				video = document.getElementById('video'),
				glasses = document.getElementById('glasses'),
				detector;
					
			try {
				compatibility.getUserMedia({video: true}, function(stream) {
					try {
						video.src = compatibility.URL.createObjectURL(stream);
					} catch (error) {
						video.src = stream;
					}
					compatibility.requestAnimationFrame(play);
				}, function (error) {
					alert('Please switch to a secure connection! (https)');
				});
			} catch (error) {
				alert(error);
			}
			
			function play() {
				compatibility.requestAnimationFrame(play);
				if (video.paused) video.play();
		      	
				if (video.readyState === video.HAVE_ENOUGH_DATA && video.videoWidth > 0) {
		          	
		          	// Prepare the detector once the video dimensions are known:
		          	if (!detector) {
			      		var width = ~~(60 * video.videoWidth / video.videoHeight);
						var height  =60;
			      		detector = new objectdetect.detector(width, height, 1.1, objectdetect.frontalface_alt);
			      	}
		      		
		      		// Perform the actual detection:
					var coords = detector.detect(video, 1);
					if (coords[0]) {
						var coord = coords[0];
						coord = smoother.smooth(coord);
						
						// Rescale coordinates from detector to video coordinate space:
						coord[0] *= video.videoWidth / detector.canvas.width;
						coord[1] *= video.videoHeight / detector.canvas.height;
						coord[2] *= video.videoWidth / detector.canvas.width;
						coord[3] *= video.videoHeight / detector.canvas.height;
						
						// Display glasses overlay: 
						glasses.style.left    = ~~(coord[0] + coord[2] * 1.0/8 + video.offsetLeft) + 'px';
						glasses.style.top     = ~~(coord[1] + coord[3] * 0.8/8 + video.offsetTop) + 'px';
						glasses.style.width   = ~~(coord[2] * 6/8) + 'px';
						glasses.style.height  = ~~(coord[3] * 6/8) + 'px';
						glasses.style.opacity = 1;
						
					} else {
						var opacity = glasses.style.opacity - 0.2;
						glasses.style.opacity = opacity > 0 ? opacity : 0;
					}
				}
			}
			
			[].slice.call(document.getElementById('list').children).forEach(function(e) {
				e.addEventListener('click', function() {
					glasses.src = e.src;
				}, false);
			});
		};
		</script>

		<!-- END EXPERIMENT -->

		<script>
			(function($) {
				$('.parallax').parallax();
			})(jQuery);
		</script>
	</body>
</html>